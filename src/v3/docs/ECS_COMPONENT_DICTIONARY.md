# ECS ç»„ä»¶å­—å…¸ (Component Dictionary) ğŸ“–

> **Status**: Living Document
> **Purpose**: å®šä¹‰ V3 å¼•æ“ä¸­æ‰€æœ‰æ ¸å¿ƒç»„ä»¶çš„æ ‡å‡†æ•°æ®ç»“æ„ã€‚æ‰€æœ‰æ’ä»¶å¿…é¡»éµå®ˆæ­¤å­—å…¸ï¼Œä¸¥ç¦éšæ„å‘æ˜å­—æ®µã€‚

## 1. åŸºç¡€ç»„ä»¶ (Primitives)

### `Meta` (å…ƒæ•°æ®)
**ç”¨é€”**: æè¿°å®ä½“çš„åŸºæœ¬èº«ä»½ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºè°ƒè¯•æˆ–åˆ—è¡¨å±•ç¤ºã€‚
**ä½ç½®**: `src/v3/core/ecs/types.ts`

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `name` | `string` | å®ä½“çš„æ˜¾ç¤ºåç§° (å¦‚ "Saito", "Slot 1") |
| `description?` | `string` | æè¿°/å¤‡æ³¨ (å¯é€‰) |
| `createdTime` | `number` | åˆ›å»ºæ—¶é—´æˆ³ (Date.now()) |
| `originId?` | `string` | æ¥æºID (å¦‚ Bangumi ID)ï¼Œç”¨äºå›æº¯ |
| `origin?` | `string` | æ¥æºå¹³å°æ ‡è¯† (å¦‚ 'bangumi', 'local') |

---

### `Transform` (ç©ºé—´å˜æ¢)
**ç”¨é€”**: å®šä¹‰å®ä½“åœ¨ 2D ç©ºé—´ä¸­çš„é€»è¾‘ä½ç½®ã€‚
**æ³¨æ„**: ä¸ç›´æ¥å†³å®šæ¸²æŸ“åƒç´ ï¼Œè€Œæ˜¯å†³å®šé€»è¾‘å¸ƒå±€ã€‚

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `x` | `number` | é€»è¾‘ X åæ ‡ (Grid Col Index æˆ– Pixel X) |
| `y` | `number` | é€»è¾‘ Y åæ ‡ (Grid Row Index æˆ– Pixel Y) |
| `z` | `number` | å±‚çº§ (Z-Index)ï¼Œå‚è§ `LAYERS` å¸¸é‡ |
| `width?` | `number` | é€»è¾‘å®½åº¦ |
| `height?` | `number` | é€»è¾‘é«˜åº¦ |
| `rotation?` | `number` | æ—‹è½¬è§’åº¦ (åº¦) |
| `scale?` | `number` | ç¼©æ”¾æ¯”ä¾‹ (1.0 = 100%) |
| `parentId?` | `EntityId` | çˆ¶å®¹å™¨ ID (ç”¨äºå±‚çº§åµŒå¥—) |

---

### `Visual` (è§†è§‰å¤–è§‚)
**ç”¨é€”**: å®šä¹‰å®ä½“çœ‹èµ·æ¥é•¿ä»€ä¹ˆæ ·ã€‚

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `type` | `'image' \| 'color' \| 'text'` | æ¸²æŸ“ç±»å‹ |
| `src` | `string` | å›¾ç‰‡ URL æˆ– Hex é¢œè‰²å€¼ |
| `visible` | `boolean` | æ˜¯å¦å¯è§ |
| `label?` | `string` | å›¾ç‰‡ä¸‹æ–¹çš„æ–‡å­—æ ‡ç­¾ (å¦‚è§’è‰²å) |
| `styleVariant?` | `string` | æ ·å¼å˜ä½“ (å¦‚ 'gold', 'holo')ï¼Œé…åˆ CSS ä½¿ç”¨ |
| `opacity?` | `number` | é€æ˜åº¦ (0-1) |

---

## 2. äº¤äº’ä¸çŠ¶æ€ (Interaction & State)

### `Interaction` (äº¤äº’çŠ¶æ€)
**ç”¨é€”**: è®°å½•è¿è¡Œæ—¶çš„äº¤äº’çŠ¶æ€ã€‚æ­¤ç»„ä»¶é€šå¸¸æ˜¯ **Transient (ç¬æ€)** çš„ï¼Œä¸å‚ä¸åºåˆ—åŒ–ã€‚

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `isDraggable` | `boolean` | æ˜¯å¦å…è®¸è¢«æ‹–åŠ¨ |
| `isSelectable` | `boolean` | æ˜¯å¦å…è®¸è¢«é€‰ä¸­ |
| `isSelected` | `boolean` | å½“å‰æ˜¯å¦è¢«é€‰ä¸­ |
| `isHovered` | `boolean` | å½“å‰æ˜¯å¦è¢«æ‚¬åœ |
| `isDragging` | `boolean` | å½“å‰æ˜¯å¦æ­£åœ¨è¢«æ‹–æ‹½ |

---

## 3. å¸ƒå±€ä¸“ç”¨ (Layout Specific)

### `Layout` (Slot å®šä½)
**ç”¨é€”**: **Grid System ä¸“ç”¨**ã€‚ç”¨äºæ ‡è®°ä¸€ä¸ªå®ä½“æ˜¯ "ä¹å®«æ ¼ä¸­çš„ä¸€ä¸ª Slot"ã€‚

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `x` | `number` | åˆ—ç´¢å¼• (Col Index, 0-based) |
| `y` | `number` | è¡Œç´¢å¼• (Row Index, 0-based) |
| `w` | `number` | è·¨åˆ—æ•° (Col Span, default 1) |
| `h` | `number` | è·¨è¡Œæ•° (Row Span, default 1) |
| `order` | `number` | æ’åºæƒé‡ (ç”¨äºæ‰å¹³åŒ–æ•°ç»„æ’åº) |
| `type` | `string` | æ’æ§½ç±»å‹ (å¦‚ 'slot') |
| `parent` | `string` | å½’å±å®¹å™¨ (å¦‚ 'root') |

### `GridState` (å…¨å±€ç½‘æ ¼çŠ¶æ€)
**ç”¨é€”**: è¿™æ˜¯ä¸€ä¸ª **Singleton (å•ä¾‹)** ç»„ä»¶ï¼Œé€šå¸¸æŒ‚è½½åœ¨ç‰¹å®šçš„ Config Entity ä¸Šï¼Œæè¿°æ•´ä¸ª Grid çš„é…ç½®ã€‚

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `title` | `string` | ä¸»æ ‡é¢˜ (å¦‚ "æˆ‘çš„æˆåˆ†è¡¨") |
| `cols` | `number` | åˆ—æ•° (å¦‚ 3, 4, 5) |
| `rows?` | `number` | è¡Œæ•° (é€šå¸¸ç”± cols è‡ªåŠ¨æ¨å¯¼) |
| `gap?` | `number` | é—´è· (px) |
| `customTitle?` | `string` | ç”¨æˆ·è‡ªå®šä¹‰çš„æ ‡é¢˜ |

---

## 4. ç³»ç»ŸæŒ‡ä»¤ (System Commands)

### `Command` (æŒ‡ä»¤)
**ç”¨é€”**: ä¸€æ¬¡æ€§æŒ‡ä»¤ï¼Œç”¨äºè§¦å‘ System çš„è¡Œä¸ºã€‚å¤„ç†åé€šå¸¸ä¼šè¢«åˆ é™¤æˆ–æ ‡è®°ä¸º processedã€‚

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `type` | `string` | æŒ‡ä»¤ç±»å‹ (å¦‚ 'GENERATE_GRID', 'CLEAR_ALL') |
| `payload` | `any` | æŒ‡ä»¤å‚æ•° (å¦‚ `{ cols: 4 }`) |
| `processed?` | `boolean` | æ˜¯å¦å·²å¤„ç† (é˜²æ­¢é‡å¤æ‰§è¡Œ) |

---

## å¦‚ä½•æ‰©å±•ï¼Ÿ

å¦‚æœä½ éœ€è¦æ–°çš„æ•°æ®ç»“æ„ï¼š
1.  åœ¨ `src/v3/core/ecs/types.ts` çš„ `CoreComponentMap` æ¥å£ä¸­æ·»åŠ å®šä¹‰ã€‚
2.  åœ¨æ­¤æ–‡æ¡£ä¸­è¡¥å……è¯´æ˜ã€‚
3.  (å¯é€‰) å¦‚æœæ˜¯ç§æœ‰æ’ä»¶æ•°æ®ï¼Œå¯ä»¥åªåœ¨æ’ä»¶å†…éƒ¨å®šä¹‰ï¼Œä¸éœ€è¦æ±¡æŸ“ Coreã€‚
