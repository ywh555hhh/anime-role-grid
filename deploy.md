# å¦‚ä½•éƒ¨ç½²åˆ° Cloudflare Pages (å…è´¹ & æ¨è)

Cloudflare Pages æ˜¯ç›®å‰æœ€æ¨èçš„é™æ€ç½‘ç«™æ‰˜ç®¡æœåŠ¡ï¼Œ**å®Œå…¨å…è´¹**ï¼Œé€Ÿåº¦å¿«ï¼Œä¸”ä¸éœ€è¦ä½ ç»´æŠ¤æœåŠ¡å™¨ã€‚

ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä¿å§†çº§æ•™ç¨‹ï¼š

## å‡†å¤‡å·¥ä½œ

1.  ä½ éœ€è¦ä¸€ä¸ª [GitHub](https://github.com/) è´¦å·ã€‚
2.  ä½ éœ€è¦å°†æœ¬é¡¹ç›®ä¸Šä¼ åˆ° GitHub ä»“åº“ï¼ˆå¦‚æœä½ è¿˜æ²¡åšçš„è¯ï¼‰ã€‚

## æ­¥éª¤ä¸€ï¼šä¸Šä¼ ä»£ç åˆ° GitHub

å¦‚æœä½ å·²ç»æŠŠä»£ç ä¸Šä¼ åˆ°äº† GitHubï¼Œè¯·è·³è¿‡æ­¤æ­¥ã€‚

1.  åœ¨ GitHub ä¸Šæ–°å»ºä¸€ä¸ªä»“åº“ï¼ˆCreate a new repositoryï¼‰ï¼Œæ¯”å¦‚å« `anime-grid`ã€‚
2.  åœ¨ä½ çš„æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åˆå§‹åŒ– git (å¦‚æœè¿˜æ²¡åˆå§‹åŒ–)
git init

# æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .

# æäº¤æ›´æ”¹
git commit -m "Initial commit"

# å…³è”è¿œç¨‹ä»“åº“ (æ›¿æ¢æˆä½ è‡ªå·±çš„ä»“åº“åœ°å€)
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/anime-grid.git

# æ¨é€åˆ° GitHub
git push -u origin master
```

## æ­¥éª¤äºŒï¼šåœ¨ Cloudflare Pages ä¸Šéƒ¨ç½²

1.  è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com/) å¹¶æ³¨å†Œ/ç™»å½•ã€‚
2.  åœ¨å·¦ä¾§èœå•ç‚¹å‡» **"Workers & Pages"**ã€‚
3.  ç‚¹å‡»è“è‰²çš„ **"Create application"** æŒ‰é’®ã€‚
4.  é€‰æ‹© **"Pages"** æ ‡ç­¾é¡µï¼Œç„¶åç‚¹å‡» **"Connect to Git"**ã€‚
5.  é€‰æ‹© **GitHub**ï¼Œæˆæƒ Cloudflare è®¿é—®ä½ çš„ GitHub è´¦å·ã€‚
6.  åœ¨åˆ—è¡¨ä¸­é€‰æ‹©ä½ åˆšæ‰ä¸Šä¼ çš„ `anime-grid` ä»“åº“ï¼Œç‚¹å‡» **"Begin setup"**ã€‚

## æ­¥éª¤ä¸‰ï¼šé…ç½®æ„å»ºè®¾ç½® (å…³é”®æ­¥éª¤)

åœ¨ "Set up builds and deployments" é¡µé¢ï¼Œè¯·æŒ‰å¦‚ä¸‹å¡«å†™ï¼š

*   **Project name**: é»˜è®¤å³å¯ï¼ˆè¿™å°†æ˜¯ä½ çš„åŸŸåå‰ç¼€ï¼Œä¾‹å¦‚ `anime-grid.pages.dev`ï¼‰ã€‚
*   **Production branch**: `master` (æˆ–è€… `main`)ã€‚
*   **Framework preset**: é€‰æ‹© **Vue**ã€‚
*   **Build command**: `npm run build` (Cloudflare ä¼šè‡ªåŠ¨å¡«å¥½)ã€‚
*   **Build output directory**: `dist` (Cloudflare ä¼šè‡ªåŠ¨å¡«å¥½)ã€‚

**ç¯å¢ƒå˜é‡ (å¯é€‰ä½†æ¨è):**
å¦‚æœä½ çš„é¡¹ç›®éœ€è¦ Bangumi æœç´¢åŠŸèƒ½ï¼Œä½ éœ€è¦åœ¨è¿™é‡Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼š
1.  ç‚¹å‡» **"Environment variables (advanced)"**ã€‚
2.  æ·»åŠ å˜é‡ï¼š
    *   Key: `VITE_BANGUMI_ACCESS_TOKEN`
    *   Value: `ä½ çš„Bangumi Token`
    *   Key: `VITE_BANGUMI_USER_AGENT`
    *   Value: `ä½ çš„UserAgent`

3.  ç‚¹å‡» **"Save and Deploy"**ã€‚

## æ­¥éª¤ä¸‰.5ï¼šç»‘å®š D1 æ•°æ®åº“ (è‡³å…³é‡è¦)

éƒ¨ç½²æˆåŠŸåï¼Œ**ä½ çš„ç½‘ç«™ç°åœ¨è¿˜ä¸èƒ½ä¿å­˜æ•°æ®**ï¼Œå› ä¸º Page è¿˜æ²¡æƒé™è®¿é—® D1 æ•°æ®åº“ã€‚éœ€æ‰‹åŠ¨ç»‘å®šï¼š

1.  è¿›å…¥ **Workers & Pages** -> é€‰æ‹©ä½ çš„ **`anime-grid`** é¡¹ç›®ã€‚
2.  ç‚¹å‡»é¡¶éƒ¨çš„ **Settings** (è®¾ç½®) æ ‡ç­¾é¡µã€‚
3.  åœ¨å·¦ä¾§èœå•ç‚¹å‡» **Functions** (å‡½æ•°)ã€‚
4.  å‘ä¸‹æ»šåŠ¨æ‰¾åˆ° **D1 Database Bindings** (D1 æ•°æ®åº“ç»‘å®š)ã€‚
5.  ç‚¹å‡» **Add binding** (æ·»åŠ ç»‘å®š)ï¼š
    *   **Variable name (å˜é‡å)**: å¿…é¡»å¡« `DB` (æ³¨æ„å¤§å†™ï¼Œä¸ä»£ç ä¸€è‡´)ã€‚
    *   **D1 Database**: é€‰æ‹© `anime-grid-db`ã€‚
6.  ç‚¹å‡» **Save**ã€‚
    > **æ³¨æ„**ï¼šé»˜è®¤æƒ…å†µä¸‹è¿™ä¼šåº”ç”¨åˆ° **Production** (ç”Ÿäº§ç¯å¢ƒ)ã€‚å¦‚æœä½ å¸Œæœ›åœ¨ **Preview** (é¢„è§ˆç¯å¢ƒï¼Œæ¯”å¦‚åˆ†æ”¯éƒ¨ç½²) ä¹Ÿèƒ½ä¿å­˜æ•°æ®ï¼Œä½ éœ€è¦åœ¨åŒä¸€ä¸ªé¡µé¢æ‰¾åˆ° "Preview" æ ‡ç­¾é¡µï¼ˆæˆ–è€…åœ¨æ·»åŠ æ—¶é€‰æ‹©ç¯å¢ƒï¼‰ï¼Œé‡å¤ä¸Šè¿°ç»‘å®šæ­¥éª¤ã€‚
7.  **é‡æ–°éƒ¨ç½² (Redeploy)**ï¼š
    *   å» **Deployments** æ ‡ç­¾é¡µã€‚
    *   å» **Deployments** æ ‡ç­¾é¡µã€‚
    *   ç‚¹å‡»æœ€æ–°çš„é‚£æ¬¡éƒ¨ç½²å³è¾¹çš„ä¸‰ä¸ªç‚¹ `...` -> **Retry deployment**ã€‚
    *   *æ³¨æ„ï¼šå˜é‡ç»‘å®šåªæœ‰åœ¨é‡æ–°éƒ¨ç½²åæ‰ä¼šç”Ÿæ•ˆï¼*

## æ­¥éª¤å››ï¼šç­‰å¾…éƒ¨ç½²å®Œæˆ

Cloudflare ä¼šè‡ªåŠ¨å¼€å§‹ä¸‹è½½ä»£ç ã€å®‰è£…ä¾èµ–ã€æ„å»ºé¡¹ç›®ã€‚
*   é€šå¸¸åªéœ€è¦ 1-2 åˆ†é’Ÿã€‚
*   å®Œæˆåï¼Œä½ ä¼šçœ‹åˆ° **"Success!"** çš„æç¤ºã€‚
*   ç‚¹å‡»é¡¶éƒ¨çš„é“¾æ¥ï¼ˆä¾‹å¦‚ `https://anime-grid.pages.dev`ï¼‰ï¼Œå³å¯è®¿é—®ä½ çš„ç½‘ç«™ï¼

## ä»¥åå¦‚ä½•æ›´æ–°ï¼Ÿ

éå¸¸ç®€å•ï¼ä½ åªéœ€è¦ä¿®æ”¹æœ¬åœ°ä»£ç ï¼Œç„¶åæ¨é€åˆ° GitHubï¼š

```bash
git add .
git commit -m "æ›´æ–°äº†æ–°åŠŸèƒ½"
git push
```

Cloudflare ä¼šè‡ªåŠ¨æ£€æµ‹åˆ° GitHub çš„å˜åŠ¨ï¼Œå¹¶è‡ªåŠ¨ä¸ºä½ é‡æ–°æ„å»ºå’Œå‘å¸ƒæ–°ç‰ˆæœ¬ã€‚ä½ ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼

## å¸¸è§é—®é¢˜ (Troubleshooting)

### ğŸ”´ æŠ¥é”™: `Must specify a project name` æˆ– `Missing entry-point`
**åŸå› **ï¼šä½ åœ¨ Cloudflare åå°çš„ "Build command" é‡Œå¡«é”™äº†å‘½ä»¤ã€‚
**è§£å†³æ–¹æ³•**ï¼š
1.  è¿›å…¥ Cloudflare Pages åå° -> Settings -> Builds & deploymentsã€‚
2.  ç‚¹å‡» "Edit settings"ã€‚
3.  **Build command** å¿…é¡»å¡«ï¼š`npm run build` (åƒä¸‡ä¸è¦å¡« `wrangler deploy`ï¼)ã€‚
4.  **Build output directory** å¿…é¡»å¡«ï¼š`dist`ã€‚
5.  ä¿å­˜åï¼Œå» "Deployments" æ ‡ç­¾é¡µç‚¹å‡» "Retry deployment"ã€‚

---

## æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œç›´æ¥éƒ¨ç½² (CLI)

å¦‚æœä½ é‡åˆ°äº† `Missing entry-point` é”™è¯¯ï¼Œæˆ–è€…ä¸æƒ³ä½¿ç”¨ GitHubï¼Œå¯ä»¥åœ¨æœ¬åœ°ç›´æ¥éƒ¨ç½²ã€‚

### 1. æ„å»ºé¡¹ç›®

é¦–å…ˆç¡®ä¿ä½ å·²ç»ç”Ÿæˆäº†æœ€æ–°çš„ `dist` ç›®å½•ï¼š

```bash
npm run build
```

### 2. ä½¿ç”¨ Wrangler éƒ¨ç½²

**é”™è¯¯çš„åšæ³•**ï¼šç›´æ¥è¿è¡Œ `npx wrangler deploy` (è¿™ä¼šè¢«è¯†åˆ«ä¸ºéƒ¨ç½² Worker ä»£ç ï¼Œå¯¼è‡´æŠ¥é”™)ã€‚

**æ­£ç¡®çš„åšæ³•**ï¼šä½¿ç”¨ Pages éƒ¨ç½²å‘½ä»¤ï¼Œå¹¶æŒ‡å®šè¾“å‡ºç›®å½• `dist`ï¼š

```bash
npx wrangler pages deploy dist
```

### 3. æŒ‰ç…§æç¤ºæ“ä½œ

1.  å®ƒä¼šæç¤ºä½ ç™»å½• Cloudflare è´¦å· (å¦‚æœæœªç™»å½•)ã€‚
2.  é€‰æ‹© "Create a new project" (å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡)ã€‚
3.  è¾“å…¥é¡¹ç›®åç§° (ä¾‹å¦‚ `anime-grid`)ã€‚
4.  è¾“å…¥ Production branch (é€šå¸¸å¡« `master` æˆ– `main`)ã€‚
5.  ç­‰å¾…ä¸Šä¼ å®Œæˆï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªè®¿é—®é“¾æ¥ï¼
